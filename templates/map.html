{% extends 'base.html' %}
{% block head %}

<script src="https://maps.googleapis.com/maps/api/js"></script>

<script src="/static/mapstyle.js"></script>
<script src="http://code.jquery.com/jquery.js"></script> 
<!-- <link rel="stylesheet" href="map.css"> -->

<script>
function validateForm() {
    var x = document.forms["myForm"]["fname"].value;
    if (x == null || x == "") {
        alert("Please fill in a zipcode");
        return false;
    }
}
</script>

<script type="text/javascript">
    // When the window has finished loading create our google map below
    google.maps.event.addDomListener(window, 'load', init);

    function init() {
        
        var mapOptions = {
            zoom: 4,
            center: new google.maps.LatLng(40.6700, -101.019460),

            styles: [{"featureType":"administrative","elementType":"all","stylers":[{"visibility":"on"},{"lightness":33}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2e5d4"}]},{"featureType":"poi.park","elementType":"geometry","stylers":[{"color":"#c5dac6"}]},{"featureType":"poi.park","elementType":"labels","stylers":[{"visibility":"on"},{"lightness":20}]},{"featureType":"road","elementType":"all","stylers":[{"lightness":20}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"color":"#c5c6c6"}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#e4d7c6"}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#fbfaf7"}]},{"featureType":"water","elementType":"all","stylers":[{"visibility":"on"},{"color":"#acbcc9"}]}]
        };

        // Get the HTML DOM element that will contain your map 
        var mapElement = document.getElementById('map');

        // Create the Google Map using our element and options defined above
        var map = new google.maps.Map(mapElement, mapOptions);

        // Defining the global infoWindow replaces the content inside for each marker
        var infoWindow = new google.maps.InfoWindow({
            width: 150
        });

        $.get('/sites_json', function (sites) {

            // The JSON result looks like this:

            // { 'json_list': [
            // {'annualTonnage': null, 'area': 50, capacity': 24029809, 'latitude': 61.293281, 'site_name': u'Anchorage Regional Landfill', 'longitude': -149.602138}, {'latitude': 58.3528, 'site_name': u'Capitol Disposal Landfill', 'longitude': -134.4947},...
            // ]}

            // accesses the nested list of dictionaries   
            var list = sites['json_list'];

            var siteId, siteName, latitude, longitude;

            // iterates through the list and identify the site id, name, lat, and long
            for (i=0; i < list.length; i++) {
                siteId = list[i]["siteID"];
                siteName = list[i]["siteName"];
                latitude = list[i]["latitude"];
                longitude = list[i]["longitude"];

                // if the lat / long exist, assign them to variables lat / long
                if ((list[i]["latitude"] !== null) || (list[i]["latitude"] !== "")) {
                    // assigns markers on map for lat / longs
                    var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(latitude, longitude),
                        map: map,
                        title: 'Site Name: '+ list[i][siteName],
                        icon: '/static/images/pin.png'
                    });
                }
                closeInfoWindow(marker, map, infoWindow, siteName)
            }

            function closeInfoWindow(marker, map, infoWindow, siteName) {
                google.maps.event.addListener(marker, 'click', function () {
                    infoWindow.close();
                    //specify the content for each infoWindow
                    infoWindow.setContent(siteName);
                    infoWindow.open(map, marker);
                });
            }
        });
    };
</script>

<style>
  #map {
    width: 650px;
    height: 450px;
    margin: 0 auto 0 auto;
  }
</style>

    <!-- // <script src="/static/map.js"></script> -->

{% endblock %}

{% block body %}
    <form action="/search" onsubmit="return validateForm()">
        <input type="radio" name="waste" value="waste">Waste<br> 
        <input type="radio" name="waste" value="recycling">Recycling<br>
        <input type="radio" name="waste" value="compost">Compost<br>

        <input type="text" name="zipcode" value="Enter your zipcode">
        <input type="submit" value="submit">
    </form>
        

        <!-- The element that will contain our Google Map. This is used in both the Javascript and CSS above. -->
        <div id="map"></div>

{% endblock %}